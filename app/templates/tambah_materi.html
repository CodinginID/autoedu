<h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center gap-2">
  <i data-lucide="plus-square" class="w-5 h-5 text-blue-500"></i> Tambah Materi
</h3>

<form method="POST" enctype="multipart/form-data" class="space-y-4">
  <!-- Judul & Deskripsi -->
  <div>
    <label class="block font-medium text-gray-700">Judul Materi</label>
    <input type="text" name="judul" required class="w-full border border-gray-300 rounded-lg px-3 py-2">
  </div>
  <div>
    <label class="block font-medium text-gray-700">Deskripsi Materi</label>
    <textarea name="deskripsi" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2"></textarea>
  </div>

  <!-- Apersepsi (Upload Video) -->
  <!-- <div>
    <label class="block font-semibold text-gray-600">Apersepsi (Upload Video)</label>
    <input type="file" name="video_apersepsi" accept="video/*" class="w-full border rounded-lg px-3 py-2">
  </div> -->

  <!-- Upload Apersepsi (Video) -->
  <div class="mb-4">
    <label class="block font-semibold text-gray-700 mb-1">Apersepsi (Upload Video)</label>
    
    <label for="videoUpload" class="flex items-center gap-3 px-4 py-2 bg-white border-2 border-dashed border-blue-400 rounded-lg cursor-pointer hover:bg-blue-50">
      <i data-lucide="upload-cloud" class="w-6 h-6 text-blue-600"></i>
      <span class="text-sm text-gray-700">Pilih Video</span>
    </label>
    <input type="file" name="video_apersepsi" id="videoUpload" accept="video/*" class="hidden">

    <div class="mt-2">
      <progress id="uploadProgress" value="0" max="100" class="w-full h-2 rounded bg-gray-200 text-blue-600 hidden"></progress>
      <span id="uploadStatus" class="text-xs text-gray-500"></span>
    </div>
  </div>

  <!-- Sub Materi Lain -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <label class="block font-semibold text-gray-600">KI/KD</label>
      <textarea name="sub_ki_kd" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
    </div>
    <div>
      <label class="block font-semibold text-gray-600">Materi</label>
      <textarea name="sub_materi" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
    </div>
    <div>
      <label class="block font-semibold text-gray-600">Simulasi</label>
      <textarea name="sub_simulasi" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
    </div>
    <div>
      <label class="block font-semibold text-gray-600">Pengayaan</label>
      <textarea name="sub_pengayaan" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
    </div>
  </div>

  <div class="text-right pt-4">
    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Simpan</button>
  </div>
</form>

<script>
  const form = document.querySelector('form');
  const progressBar = document.getElementById('uploadProgress');
  const uploadStatus = document.getElementById('uploadStatus');
  const videoInput = document.getElementById('videoUpload');

  form.addEventListener('submit', function (e) {
    e.preventDefault(); // prevent default

    const formData = new FormData(form);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', '', true); // post ke endpoint saat ini

    // progress bar visible
    progressBar.classList.remove('hidden');

    // on progress update
    xhr.upload.addEventListener('progress', function (e) {
      if (e.lengthComputable) {
        const percent = Math.round((e.loaded / e.total) * 100);
        progressBar.value = percent;
        uploadStatus.innerText = `Uploading... ${percent}%`;
      }
    });

    // on complete
    xhr.onload = function () {
      if (xhr.status === 200) {
        uploadStatus.innerText = "Upload selesai ✅";
        setTimeout(() => {
          window.location.reload();
        }, 500);
      } else {
        uploadStatus.innerText = "Upload gagal ❌";
      }
    };

    xhr.send(formData);
  });
</script>

